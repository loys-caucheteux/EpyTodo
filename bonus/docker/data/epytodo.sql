CREATE DATABASE IF NOT EXISTS epytodo;
USE epytodo;
CREATE TABLE IF NOT EXISTS user
(
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL,
  password VARCHAR(100) NOT NULL,
  name VARCHAR(100) NOT NULL,
  firstname VARCHAR(100) NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
)ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS todo
(
  id INT AUTO_INCREMENT PRIMARY KEY NOT NULL,
  title VARCHAR(100) NOT NULL,
  description TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  due_time DATETIME NOT NULL,
  status VARCHAR(20) DEFAULT 'not started',
  user_id INT UNSIGNED,
  CONSTRAINT todo_user FOREIGN KEY (user_id) REFERENCES user (id) ON DELETE CASCADE,
  CHECK (status in ('not started','todo', 'in progress', 'done'))
)ENGINE=INNODB
GRANT ALL ON epytodo.* to 'root'@'172.21.0.4' IDENTIFIED BY 'passwd';
GRANT ALL ON epytodo.* to 'root'@'172.17.0.1' IDENTIFIED BY 'passwd';
FLUSH PRIVILEGES;